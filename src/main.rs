use ilearn::{run, Config};
use std::{env, error::Error, fs, process};

fn main() {
    /*
     * ## é—­åŒ… Closure
     *
     * > æœ¬ç« å†…å®¹è¾ƒé•¿ï¼Œä¸”åœ¨æœ¬ç« å†…å®¹å°¾éƒ¨æ›´æ–°äº†å¯¹é—­åŒ…çš„è®¤è¯†ï¼Œè¯»è€…åº”è¯»å®Œå…¨ç« ï¼Œä¸è¦å–å…¶ä¸­éƒ¨åˆ†ã€‚
     *
     * é—­åŒ…æ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œå®ƒå¯ä»¥èµ‹å€¼ç»™å˜é‡ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶å®ƒå‡½æ•°ï¼Œä¸åŒäºŽå‡½æ•°çš„æ˜¯ï¼Œå®ƒå…è®¸æ•èŽ·è°ƒç”¨è€…ä½œç”¨åŸŸä¸­çš„å€¼ã€‚
     *
     * Rust é—­åŒ…åœ¨å½¢å¼ä¸Šå€Ÿé‰´äº† Smalltalk å’Œ Ruby è¯­è¨€ï¼Œä¸Žå‡½æ•°æœ€å¤§çš„ä¸åŒå°±æ˜¯å®ƒçš„å‚æ•°æ˜¯é€šè¿‡ |parm1| çš„å½¢å¼è¿›è¡Œå£°æ˜Žï¼Œå¦‚æžœæ˜¯å¤šä¸ªå‚æ•°å°± |param1, param2,...|ï¼Œé—­åŒ…çš„å½¢å¼å®šä¹‰ï¼š
     * ```rust
     * |param1, param2,...| {
     *     è¯­å¥1;
     *     è¯­å¥2;
     *     è¿”å›žè¡¨è¾¾å¼
     * }
     * ```
     *
     * ### é—­åŒ…ä½œä¸ºå‡½æ•°è¿”å›žå€¼
     * åœ¨å®žçŽ° `Cacher` ä¸­æˆ‘ä»¬å°†é—­åŒ…ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰ï¼ŒçŽ°åœ¨è€ƒè™‘å¦‚ä½•å°†é—­åŒ…åº”ç”¨åœ¨å‡½æ•°çš„è¿”å›žå€¼ä¸Šï¼Œå› ä¸ºåªæœ‰è¿™æ ·ï¼Œæ‰èƒ½å°†å†…éƒ¨å€¼ä¼ é€’å‡ºåŽ»ã€‚
     *
     * é—­åŒ…åœ¨Rustä¸­æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç‰¹æ€§ï¼šæ¯ä¸ªé—­åŒ…éƒ½æœ‰å…¶è‡ªå·±ç‹¬ç‰¹çš„åŒ¿åç±»åž‹ï¼ˆè¿™ä¸ªç±»åž‹å°±æ˜¯ç±»ä¼¼ `i32 String` çš„ä¸€ç§æ•°æ®æ ¼å¼ç±»åž‹ï¼‰ï¼Œè¿™æ˜¯å› ä¸º**é—­åŒ…ç±»åž‹ä¸ä»…ä»…æ˜¯ç”±å…¶å‚æ•°å’Œè¿”å›žç±»åž‹å®šä¹‰**çš„ï¼Œè¿˜åŒ…æ‹¬å®ƒæ•èŽ·çš„çŽ¯å¢ƒã€‚æ¯ä¸ªé—­åŒ…æ ¹æ®å…¶æ•èŽ·çš„çŽ¯å¢ƒï¼ˆå˜é‡ã€ç”Ÿå‘½å‘¨æœŸç­‰ï¼‰å…·æœ‰ä¸åŒçš„ç±»åž‹ã€‚
     * å³ä½¿ä¸¤ä¸ªé—­åŒ…æœ‰ç›¸åŒçš„ç­¾åï¼Œå®ƒä»¬ä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ç±»åž‹ã€‚è¿™æ„å‘³ç€ç›´æŽ¥è¿”å›žé—­åŒ…ç±»åž‹ï¼ˆ`Fn(i32) -> i32`ï¼‰æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºé—­åŒ…çš„å…·ä½“ç±»åž‹æ˜¯æœªçŸ¥çš„ï¼Œä¸”æ— æ³•ç›´æŽ¥å‘½åã€‚
     *
     *
     * #### æ­£ç¡®æ ‡æ³¨é—­åŒ…ä½œä¸ºå‡½æ•°è¿”å›žå€¼
     * ä½¿ç”¨impl Traitè¯­æ³•å…è®¸æˆ‘ä»¬è¿”å›žä¸€ä¸ªå®žçŽ°äº†æŒ‡å®štraitçš„ç±»åž‹ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå…·ä½“çš„ç±»åž‹ã€‚ï¼ˆimpl Trait å½¢å¼æ¥è¯´æ˜Žä¸€ä¸ªå‡½æ•°è¿”å›žäº†ä¸€ä¸ªç±»åž‹ï¼Œè¯¥ç±»åž‹å®žçŽ°äº†æŸä¸ªç‰¹å¾ï¼Œå¤–éƒ¨ä½¿ç”¨æ—¶åªèƒ½ä½¿ç”¨è¯¥ç‰¹å¾å·²å£°æ˜Žçš„å±žæ€§ï¼‰(å‡½æ•°è¿”å›žä¸­çš„impl trait)[https://course.rs/basic/trait/trait.html#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E4%B8%AD%E7%9A%84-impl-trait]
     * ä½¿ç”¨ `impl trait` å½¢å¼å°†é—­åŒ…æ ‡è¯†ä¸ºå®žçŽ°äº†æŸä¸ªç‰¹å¾çš„ç±»åž‹åŽå°±å¯ä»¥è¿”å›žã€‚åœ¨é—­åŒ…çš„åœºæ™¯ä¸­ï¼ŒFnã€FnMutã€FnOnceå®ƒä»¬åˆ†åˆ«å¯¹åº”ä¸åŒçš„é—­åŒ…ç±»åž‹ã€‚é€šè¿‡è¿”å›žimpl Fn(å‚æ•°ç±»åž‹) -> è¿”å›žå€¼ç±»åž‹ï¼Œè¿™å°†å‘Šè¯‰Rustç¼–è¯‘å™¨ï¼Œè¿”å›žä¸€ä¸ªå®žçŽ°äº†Fn traitçš„ç±»åž‹ï¼Œä½†ä¸æŒ‡å®šå…·ä½“æ˜¯å“ªä¸ªç±»åž‹ã€‚
     * ç®€è€Œè¨€ä¹‹ï¼Œimplå…³é”®è¯çš„ä½¿ç”¨æ˜¯å› ä¸ºé—­åŒ…çš„ç±»åž‹æ˜¯åŒ¿åä¸”ä¸å¯ç›´æŽ¥å‘½åçš„ï¼Œè€Œimpl Traitè¯­æ³•å…è®¸æˆ‘ä»¬ä»¥ä¸€ç§æŠ½è±¡çš„æ–¹å¼è¿”å›žå®žçŽ°äº†ç‰¹å®štraitçš„é—­åŒ…ï¼Œè€Œæ— éœ€å…³å¿ƒé—­åŒ…çš„å…·ä½“ç±»åž‹ã€‚è¿™å¤§å¤§å¢žåŠ äº†ä»£ç çš„çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚
     *
     * ä¸ºä»€ä¹ˆé—­åŒ…ä½œä¸ºå‡½æ•°çš„å‚æ•°æ—¶ä¸éœ€è¦æ˜¾å¼çš„æŒ‡å®š impl ï¼Ÿ
     * å½“é—­åŒ…ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œ**ä¸éœ€è¦**ä½¿ç”¨implå…³é”®å­—ï¼Œæ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥ç›´æŽ¥æŒ‡å®šé—­åŒ…å‚æ•°éµå¾ªçš„ç‰¹å®štraitï¼ˆå¦‚Fnã€FnMutæˆ–FnOnceï¼‰ã€‚
     * è¿™æ˜¯é€šè¿‡ä½¿ç”¨**traitç•Œå®šï¼ˆtrait boundsï¼‰**æ¥å®žçŽ°çš„(ç®€å•ç†è§£ä¸ºè‡ªåŠ¨æŽ¨æ–­å’Œå®žçŽ°)ï¼Œå®ƒå…è®¸å‡½æ•°æŽ¥å—ä»»ä½•å®žçŽ°äº†æŒ‡å®štraitçš„ç±»åž‹ã€‚è¿™ç§æ–¹å¼æä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§ï¼ŒåŒæ—¶é¿å…äº†impl Traitåœ¨å‚æ•°ä½ç½®çš„ä½¿ç”¨ã€‚
     *
     * ```rust
     * fn factory() -> impl Fn(i32) -> i32 {
     *     let num = 5;
     *     move |x| x + num
     * }
     *
     * let f = factory();
     * let answer = f(1);
     * assert_eq!(6, answer);
     * ```
     *
     * ç”¨ `impl trait` å½¢å¼å®žçŽ°é—­åŒ…ä½œä¸ºè¿”å›žå€¼è¿”å›žï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯ `impl trait` è¦æ±‚è¿”å›žåªèƒ½æœ‰ä¸€ä¸ªå…·ä½“çš„ç±»åž‹ã€‚è€Œé—­åŒ…å³ä½¿ç­¾åä¸€è‡´ä¹Ÿå¯èƒ½æ˜¯ä¸åŒçš„ç±»åž‹ã€‚
     * ```rust
     * ç¼–è¯‘é”™è¯¯ error
     * fn factory(x: i32) -> impl Fn(i32) -> i32 {
     *     let num = 5;
     *     if x > 1 {
     *         |x| x + num
     *      } else {
     *          |x| x - num
     *      }
     * }
     * ```
     *
     * ä¸Žimpl traitç›¸å¯¹åº”çš„ï¼ŒåŠ¨æ€ç‰¹å¾å¯¹è±¡ä¸é™åˆ¶æŸä¸€ä¸ªå…·ä½“çš„ç±»åž‹ï¼Œå› æ­¤å¯æ”¹ä¸ºä½¿ç”¨åŠ¨æ€ç‰¹å¾å¯¹è±¡è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
     * ```rust
     * fn factory(x:i32) -> Box<dyn Fn(i32) -> i32> {
     *     let num = 5;
     *     if x > 1{
     *         Box::new(move |x| x + num)
     *     } else {
     *         Box::new(move |x| x - num)
     *     }
     * }
     * ```
     *
     * ### & mut &mut çš„å„ç§ä½ç½®è®¤è¯†
     * é˜…è¯»ï¼šhttps://github.com/sunface/rust-course/discussions/619#discussioncomment-2623736
     *
     * - fn do1(c: String) {}ï¼šè¡¨ç¤ºå®žå‚ä¼šå°†æ‰€æœ‰æƒä¼ é€’ç»™ c
     * - fn do2(c: &String) {}ï¼šè¡¨ç¤ºå®žå‚çš„ä¸å¯å˜å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ä¼ é€’ç»™ cï¼Œå®žå‚éœ€å¸¦ & å£°æ˜Ž
     * - fn do3(c: &mut String) {}ï¼šè¡¨ç¤ºå®žå‚å¯å˜å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ä¼ é€’ç»™ cï¼Œå®žå‚éœ€å¸¦ let mut å£°æ˜Žï¼Œä¸”ä¼ å…¥éœ€å¸¦ &mut
     * - fn do4(mut c: String) {}ï¼šè¡¨ç¤ºå®žå‚ä¼šå°†æ‰€æœ‰æƒä¼ é€’ç»™ cï¼Œä¸”åœ¨å‡½æ•°ä½“å†… c æ˜¯å¯è¯»å¯å†™çš„ï¼Œå®žå‚æ— éœ€ mut å£°æ˜Ž
     * - fn do5(mut c: &mut String) {}ï¼šè¡¨ç¤ºå®žå‚å¯å˜å¼•ç”¨æŒ‡å‘çš„å€¼ä¼ é€’ç»™ cï¼Œä¸” c åœ¨å‡½æ•°ä½“å†…éƒ¨æ˜¯å¯è¯»å¯å†™çš„ï¼Œå®žå‚éœ€å¸¦ let mut å£°æ˜Žï¼Œä¸”ä¼ å…¥éœ€å¸¦ &mut
     *
     * ä¸€å¥è¯æ€»ç»“ï¼šåœ¨å‡½æ•°å‚æ•°ä¸­ï¼Œå†’å·å·¦è¾¹çš„éƒ¨åˆ†ï¼Œå¦‚ï¼šmut cï¼Œè¿™ä¸ª mut æ˜¯å¯¹ðŸª„å‡½æ•°ä½“å†…éƒ¨æœ‰æ•ˆðŸª„ï¼›å†’å·å³è¾¹çš„éƒ¨åˆ†ï¼Œå¦‚ï¼š&mut Stringï¼Œè¿™ä¸ª &mut æ˜¯é’ˆå¯¹ðŸª„å¤–éƒ¨å®žå‚ä¼ å…¥æ—¶çš„å½¢å¼ï¼ˆå£°æ˜Žï¼‰è¯´æ˜ŽðŸª„ã€‚
     *
     * ### é˜…è¯»
     * - [æ³›åž‹ã€ç‰¹å¾ã€ç‰¹å¾å¯¹è±¡](https://course.rs/basic/trait/intro.html)
     *
     *
     *
     */

    let x = 2;
    let closure = || println!("{}", x);

    fn factory() -> impl Fn(i32) -> i32 {
        let x = 2;
        let closure = move |a| x + a;
        closure
    }

    let f = factory();
    println!("{}", f(1));

    // fn factory(x: i32) -> impl Fn(i32) -> i32 {
    //     let num = 5;
    //     if x > 1 {
    //         |x| x + num
    //     } else {
    //         |x| x - num
    //     }
    // }
}
